CREATE TABLE companies (
                           company_id SERIAL PRIMARY KEY,
                           company_name VARCHAR(255) NOT NULL
);

CREATE TABLE branches (
                          branch_id SERIAL PRIMARY KEY,
                          company_id INT NOT NULL
                              REFERENCES companies(company_id) ON DELETE CASCADE,
                          branch_name VARCHAR(255) NOT NULL
);


CREATE TABLE user_front (
                            user_id SERIAL PRIMARY KEY,
                            company_id INT NOT NULL
                                REFERENCES companies(company_id)  ON DELETE CASCADE,
                            branch_id INT NOT NULL
                                REFERENCES branches(branch_id) ON DELETE CASCADE
);

CREATE TABLE user_role (
                           role_id SERIAL PRIMARY KEY,
                           role_name VARCHAR(50) UNIQUE NOT NULL
);

CREATE TABLE user_role_new (
                               assignment_id SERIAL PRIMARY KEY,
                               user_id INT NOT NULL
                                   REFERENCES user_front(user_id) ON DELETE CASCADE,
                               role_id INT NOT NULL
                                   REFERENCES user_role(role_id),
                               company_id INT NOT NULL
                                   REFERENCES companies(company_id),
                               branch_id INT NOT NULL
                                   REFERENCES branches(branch_id),
                               UNIQUE (user_id, role_id)
);

CREATE TABLE contact (
                         contact_id SERIAL PRIMARY KEY,
                         contact_type VARCHAR(20) ,
                         whatsapp_no VARCHAR(20),
                         pan_no VARCHAR(20)
);

CREATE TABLE contact_address (
                                 contact_address_id SERIAL PRIMARY KEY,
                                 contact_id INT NOT NULL
                                     REFERENCES contact(contact_id) ON DELETE CASCADE,
                                 address_line_1 TEXT NOT NULL,
                                 address_line_2 TEXT,
                                 city_name VARCHAR(100),
                                 state_name VARCHAR(100),
                                 country_name VARCHAR(100),
                                 mob_no VARCHAR(20)
);

CREATE TABLE product (
                         product_id SERIAL PRIMARY KEY,
                         product_name VARCHAR(255) NOT NULL,
                         company_id INT NOT NULL
                             REFERENCES companies(company_id),
                         item_code VARCHAR(50) UNIQUE
);


CREATE TABLE sales (
                       sales_id SERIAL PRIMARY KEY,
                       contact_id INT REFERENCES contact(contact_id),
                       company_id INT NOT NULL REFERENCES companies(company_id),
                       branch_id INT NOT NULL REFERENCES branches(branch_id),
                       prefix VARCHAR(10),
                       sales_no VARCHAR(50) NOT NULL,
                       total_amount DECIMAL(15,2),
                       sales_date DATE DEFAULT CURRENT_DATE,
                       UNIQUE (company_id, branch_id, sales_no)
);

CREATE TABLE purchase (
                          purchase_id SERIAL PRIMARY KEY,
                          contact_id INT REFERENCES contact(contact_id),
                          company_id INT NOT NULL REFERENCES companies(company_id),
                          branch_id INT NOT NULL REFERENCES branches(branch_id),
                          prefix VARCHAR(10),
                          purchase_no VARCHAR(50) NOT NULL,
                          total_amount DECIMAL(15,2),
                          purchase_date DATE DEFAULT CURRENT_DATE,
                          UNIQUE (company_id, branch_id, purchase_no)
);

CREATE TABLE sales_item (
                            sales_item_id SERIAL PRIMARY KEY,
                            sales_id INT REFERENCES sales(sales_id) ON DELETE CASCADE,
                            product_id INT REFERENCES product(product_id),
                            quantity INT CHECK (quantity > 0),
                            selling_price DECIMAL(15,2)
);

CREATE TABLE purchase_item (
                               purchase_item_id SERIAL PRIMARY KEY,
                               purchase_id INT REFERENCES purchase(purchase_id) ON DELETE CASCADE,
                               product_id INT REFERENCES product(product_id),
                               quantity INT CHECK (quantity > 0),
                               purchase_price DECIMAL(15,2)
);



